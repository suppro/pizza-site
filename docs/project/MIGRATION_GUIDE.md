# Руководство по миграции на новую структуру БД

## Важно!

Перед запуском миграций убедитесь, что:
1. База данных `arviay_shop` создана
2. В `.env` указаны правильные данные для подключения к БД
3. У вас есть резервная копия данных (если они важны)

## Порядок выполнения миграций

Миграции выполняются в следующем порядке:

1. **0001_01_01_000000_create_users_table.php** - создает базовую таблицу users
2. **2025_12_01_191830_update_users_table_for_arviay_shop.php** - добавляет поля phone и role
3. **2025_12_01_191831_create_categories_table_for_arviay_shop.php** - создает новую таблицу categories (удаляет старую)
4. **2025_12_01_191832_create_products_table_for_arviay_shop.php** - создает новую таблицу products (удаляет старые)
5. **2025_12_01_191833_create_product_images_table_for_arviay_shop.php** - создает таблицу изображений
6. **2025_12_01_191834_create_orders_table_for_arviay_shop.php** - создает новую таблицу orders (удаляет старую)
7. **2025_12_01_191828_create_order_items_table_for_arviay_shop.php** - создает новую таблицу order_items

## Старые миграции

Старые миграции от пиццерии (2025_11_29_*) будут пропущены, так как новые миграции удаляют и пересоздают соответствующие таблицы.

## Запуск миграций

```bash
php artisan migrate
```

Если возникнут ошибки с полнотекстовым индексом (MySQL версия < 5.6), можно временно закомментировать строку 41 в миграции `2025_12_01_191832_create_products_table_for_arviay_shop.php`.

## После миграций

Запустите сидер для заполнения начальными данными:

```bash
php artisan db:seed
```

## Откат миграций

Если нужно откатить миграции:

```bash
php artisan migrate:rollback --step=7
```

Или полностью сбросить:

```bash
php artisan migrate:fresh --seed
```

**ВНИМАНИЕ**: `migrate:fresh` удалит все данные из базы!

